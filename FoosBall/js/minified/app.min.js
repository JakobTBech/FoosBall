function BaseController(b,a){b.session={};var e=c();e.then(function(){d()});function d(){var g=a("/Base/GetSession");var f=g.get().$promise;f.then(function(h){angular.forEach(h,function(j,i){b.session[i]=j})})}function c(){var f=a("/Account/Logon"),g=f.get().$promise;return g}b.logout=function(){var f=a("/Account/LogOff"),g=f.get().$promise;g.then(function(){d()})}}BaseController.$inject=["$scope","$resource"];function AccountController(b,a){b.loginForm={};b.submitLogin=function(){var c=a("Account/LogOn",{email:b.loginForm.email,password:b.loginForm.password,rememberMe:b.submitLogin});var d=c.save().$promise;d.then(function(){})}}AccountController.$inject=["$scope","$resource"];function HomeController(){}function MatchesController(b,a){var c,e,d=document.getElementById("current-user-id");b.pageSize=10;b.hideForm=true;b.matches=[];b.hex_md5=hex_md5;b.currentUserId=d?d.value:"";b.cancelMatch=function(h){var i=b.matches[h],g=a("Matches/Delete?id="+i.Id),j=g.save().$promise;j.then(function(){b.matches.splice(h,1);var k=a("Admin/ReplayMatches"),l=k.save().$promise;l.then(function(){})})};b.onPlayerSelectFocus=function(g){c=$(g.target);e=c.find(":selected").val()};b.onPlayerSelectChange=function(){var g=c.find(":selected");$.each($('option[value="'+e+'"]').not(g),function(i,h){$(h).removeAttr("disabled")});if(!g.val()===false){$.each($('option[value="'+g.val()+'"]').not(g),function(i,h){$(h).attr("disabled","disabled")})}e=c.find(":selected").val();f()};b.getPlayers=function(){var g=a("Matches/GetPlayers");var h=g.query().$promise;h.then(function(i){b.players=i})};b.getMatches=function(i,l){var h=i||b.pageSize;var k=l||0;var g=a("Matches/GetMatches?numberOfMatches="+h+"&startFromMatch="+k);var j=g.query().$promise;j.then(function(m){angular.forEach(m,function(p,n){var o=prepareMatch(m[n]);b.matches.push(o)})})};b.getMatches(b.pageSize,b.matches.length);b.getPlayers();function f(){var i=$("#team-red-players"),g=$("#team-blue-players"),j=$(".score-prediction",i),h=$(".score-prediction",g),o=$('[name="redPlayer1"]',i).find(":selected").attr("data-player-rating"),p=$('[name="redPlayer2"]',i).find(":selected").attr("data-player-rating"),k=$('[name="bluePlayer1"]',g).find(":selected").attr("data-player-rating"),l=$('[name="bluePlayer2"]',g).find(":selected").attr("data-player-rating"),q=parseInt(nvl(o,0))+parseInt(nvl(p,0)),m=parseInt(nvl(k,0))+parseInt(nvl(l,0)),r=Math.max(q,m),n=Math.min(q,m);if(q!==0&&m!==0){$.ajax({url:"Matches/GetRating",data:{winnerRating:r,loserRating:n,},type:"get",success:function(s){var w=Math.round(q),t=Math.round(m),x=Math.round(100*s.ExpectedScore),u=Math.round(100-(100*s.ExpectedScore)),y=Math.round(s.RatingModifier),v=Math.round(s.KModifier-s.RatingModifier);if(q===r){j.find(".rating").text(w);j.find(".chance").text(x);j.find(".gain").text(y);h.find(".rating").text(t);h.find(".chance").text(u);h.find(".gain").text(v)}else{h.find(".rating").text(t);h.find(".chance").text(x);h.find(".gain").text(y);j.find(".rating").text(w);j.find(".chance").text(u);j.find(".gain").text(v)}j.removeClass("hide");h.removeClass("hide")}})}else{j.addClass("hide");h.addClass("hide")}}}MatchesController.$inject=["$scope","$resource"];function SubmitMatchController(b,a){b.submitMatch=function(){var c=a("Matches/SubmitMatch");var d=c.save(b.match).$promise;d.then(function(f){angular.forEach(b.match,function(h,g){b.match[g]=null});$("option:disabled").removeAttr("disabled");b.$parent.hideForm=true;if(f.success){var e=prepareMatch(f.returnedMatch);b.matches.unshift(e)}})}}SubmitMatchController.$inject=["$scope","$resource"];function prepareMatch(b){var c=parseInt(b.GameOverTime.replace(/\D/g,""));var a=new Date(c);b.UnixTime=c;b.DistributedRating=b.DistributedRating.toString().replace(/(\d{1,2})(\.)(\d{2})(.*)/g,"$1,$3");b.GameOverDate=a.toDateString().replace(/(\w{3}) (\w{3}) (\d{2}) (\d{2})(\d{2})/g,a.getDate()+" $2  $5");b.GameOverTime=a.toLocaleTimeString().replace(/(\d{2})(\.)(\d{2})(\.)(\d{2})/g,", $1:$3");return b}function PlayersController(b,a){b.players=[];b.getPlayers=function(){var d=a("Players/GetPlayers");var e=d.query().$promise;e.then(function(f){var g;angular.forEach(f,function(i,h){g=c(i,h);b.players.push(g)})})};b.getPlayers();function c(e,d){e.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(e.Email)+"?d=mm";e.Ranking=d+1;e.Rating1=parseFloat(e.Rating).toFixed(0);e.Rating2=parseFloat(e.Rating).toFixed(2);e.Ratio1=parseFloat(e.Ratio).toFixed(2);e.Ratio2=parseFloat(e.Ratio).toFixed(4);return e}}PlayersController.$inject=["$scope","$resource"];function PlayerStatsController(b,a){b.playerStats=[];b.hex_md5=hex_md5;b.getPlayerStats=function(){var h="?playerId="+$location.search()["playerId"],f=a("/Stats/GetPlayerStatistics"+h),g=f.get().$promise;g.then(function(i){b.playerStats=d(i)})};b.getPlayerRatingData=function(){var i="?playerId="+$location.search()["playerId"],f=a("/Stats/GetPlayerRatingData"+i),h=f.get().$promise,g;h.then(function(j){g=c(j);e(g)})};b.getPlayerStatsUrl=function(f){return"/#/playerstats?playerId="+f};b.getPlayerStats();b.getPlayerRatingData();function d(f){var g="/#/playerstats?playerId=";f.Player.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(f.Player.Email)+"?d=mm";f.Player.Url=g+f.Player.Id;f.Bff.Player.Url=g+f.Bff.Player.Id;f.Rbff.Player.Url=g+f.Rbff.Player.Id;f.Eae.Player.Url=g+f.Eae.Player.Id;return f}function c(f){var g={DataPoints:[]};angular.forEach(f.DataPoints,function(i,h){g.DataPoints.push([new Date(Date.UTC(i.TimeSet[0],parseInt(i.TimeSet[1])-1,i.TimeSet[2],i.TimeSet[3],i.TimeSet[4],i.TimeSet[5])).toDateString(),parseFloat(i.Rating.toPrecision(6))])});g.MinimumValue=f.MinimumValue-50;g.MaximumValue=f.MaximumValue+50;g.PlayerName=f.Player.Name;g.DataPoints[0][0]='The "birth" of '+g.PlayerName;return g}function e(f){new Highcharts.Chart({chart:{renderTo:"player-rating-chart",zoomType:"x",spacingRight:10},title:{text:f.PlayerName+"s rating over time"},subtitle:{text:document.ontouchstart===undefined?"Click and drag in the plot area to zoom in":"Drag your finger over the plot to zoom in"},xAxis:{title:{text:null}},yAxis:{title:{text:null},min:f.MinimumValue,max:f.MaximumValue,startOnTick:false,showFirstLabel:false},tooltip:{shared:true},legend:{enabled:false},plotOptions:{area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,"rgba(2,0,0,0)"]]},lineWidth:1,marker:{enabled:false,states:{hover:{enabled:true,radius:5}}},shadow:false,states:{hover:{lineWidth:1}}}},series:[{type:"area",name:"Rating",data:f.DataPoints}]})}}PlayerStatsController.$inject=["$scope","$resource"];function StatsController(b,a){b.stats=[];b.hex_md5=hex_md5;b.getStats=function(){var e=a("Stats/GetStatistics");var d=e.get().$promise;d.then(function(f){b.stats=c(f)})};b.getPlayerStatsUrl=function(d){return"/#/playerstats?playerId="+d};b.getStats();function c(d){d.MostFights.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.MostFights.Email)+"?d=mm";d.MostWins.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.MostWins.Email)+"?d=mm";d.MostLosses.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.MostLosses.Email)+"?d=mm";d.TopRanked.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.TopRanked.Email)+"?d=mm";d.BottomRanked.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.BottomRanked.Email)+"?d=mm";d.HighestRatingEver.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.HighestRatingEver.Email)+"?d=mm";d.LowestRatingEver.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.LowestRatingEver.Email)+"?d=mm";d.LongestWinningStreak.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.LongestWinningStreak.Player.Email)+"?d=mm";d.LongestLosingStreak.GravatarUrl="http://www.gravatar.com/avatar/"+hex_md5(d.LongestLosingStreak.Player.Email)+"?d=mm";return d}}StatsController.$inject=["$scope","$resource"];angular.module("FoosBall",["ngRoute","ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"/partials/home.html"}).when("/stats",{templateUrl:"/partials/stats.html"}).when("/playerstats",{templateUrl:"/partials/playerstats.html"}).when("/features",{templateUrl:"/partials/features.html"}).when("/matches",{templateUrl:"/partials/matches.html",controller:MatchesController}).when("/players",{templateUrl:"/partials/players.html",controller:PlayersController}).when("/logon",{templateUrl:"/partials/logon.html",controller:PlayersController}).when("/edit-user",{templateUrl:"/partials/edit-user.html",controller:PlayersController}).otherwise({redirectTo:"/"})}]).directive("foosballScore",function(){return{require:"ngModel",link:function(d,c,a,b){b.$parsers.unshift(function(f){var e=document.querySelector(".team-score:not(#"+c.attr("id")+")");if(!f||!e.value||f===e.value){d.resolveMatchForm.redScore.$setValidity("foosballScore",false);d.resolveMatchForm.blueScore.$setValidity("foosballScore",false)}else{d.resolveMatchForm.redScore.$setValidity("foosballScore",true);d.resolveMatchForm.blueScore.$setValidity("foosballScore",true)}return f})}}}).directive("timeLeftToEdit",function(a){return function(g,c,b){if(g.currentUserId){var h,e=b.timeLeftToEdit;function d(){var k=new Date().getTime(),m=1000*60*5,l=e-k+m;if(l<=0){c.remove()}else{c.removeClass("hide")}return f(l)}function f(k){var m=parseInt((k/1000)%60),l=parseInt((k/(1000*60))%60);if(m<10){m="0"+m}return l+":"+m}function j(){c.val("Cancel match ("+d()+")")}function i(){h=a(function(){j();i()},1000)}c.on("$destroy",function(){a.cancel(h)});if(g.match.PlayersHash.indexOf(g.currentUserId)>-1){i()}}}});